name: Check and add Members

on:
  issue_comment:
    types: [created]

jobs:
  check_membership:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      
      - name: Check Membership
        run: |
          # Set organization name, username, and token
          ORG_NAME="myorgpradeem"
          USERNAME="${{ github.event.inputs.username }}"
          TOKEN="${{  secrets.API_TOKEN }}"
          
          # Make request to GitHub API
          response=$(curl -s -o /dev/null -w "%{http_code}" -H "Authorization: token $TOKEN" \
                      -H "Accept: application/vnd.github.v3+json" \
                      "https://api.github.com/orgs/$ORG_NAME/memberships/$USERNAME")
          
          # Check response status
          if [ $response -eq 200 ]; then
		      - name: Extract Variables
                id: extract
                run: |
                  echo "${{ github.event.comment.body }}" > comment.txt
                  cat comment.txt  # Check the content of comment.txt
                  VAR_NAME=$(cat comment.txt | cut -d' ' -f2)  # Extract the variable using cut
                  echo "Extracted Variable: $VAR_NAME"
                  echo "VAR_NAME=$VAR_NAME" >> $GITHUB_ENV  # Set the environment variable using Environment Files

              - name: Use Variables
                run: |
                  curl -L -X PUT -H "Accept: application/vnd.github+json" -H "Authorization: Bearer ${{ secrets.API_TOKEN }}" -H "X-GitHub-Api-Version: 2022-11-28" https://api.github.com/orgs/myorgpradeem/teams/myteam/memberships/$VAR_NAME
             
          elif [ $response -eq 204 ]; then
              echo "$USERNAME is not a member of $ORG_NAME."
          elif [ $response -eq 404 ]; then
              echo "Error: $USERNAME or $ORG_NAME not found."
          else
              echo "Error: HTTP status code $response"
          fi
        env:
          GITHUB_TOKEN: ${{  secrets.API_TOKEN }}
